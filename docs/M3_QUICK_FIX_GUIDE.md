# ⚡ M3 빠른 수정 가이드

## 🚨 현재 문제

### 1. 로그인 실패
```
증상: "아이디 또는 비밀번호가 올바르지 않습니다"
원인: 개발 중 비밀번호가 변경됨
해결: 테스트 계정 정리 후 재가입
```

### 2. M3 점검 완료
```
✅ 간병인 링크 생성/복사: 구현됨
✅ 토큰으로 케이스 조회: 구현됨
⚠️ 간병인 휴대폰 인증: 누락 (선택적)
✅ 간병일지 작성: 구현됨
```

---

## ⚡ 1분 안에 해결하기

### Step 1: Supabase에서 테스트 계정 정리 (30초)

#### 방법: SQL Editor 사용

```
1. https://supabase.com/dashboard 접속
2. 프로젝트 선택
3. SQL Editor 메뉴
4. New Query
5. 아래 SQL 복사 붙여넣기:
```

```sql
-- 모든 테스트 계정 정리
DELETE FROM cases;
DELETE FROM users;

-- OTP 정리
DELETE FROM phone_otps WHERE used = true;
DELETE FROM phone_otps WHERE expires_at < NOW();

-- 확인
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM cases;
```

```
6. Run 클릭
7. 결과 확인: users와 cases가 0 rows
```

---

### Step 2: 새 계정으로 재가입 (30초)

```
1. 브라우저: Ctrl + Shift + R

2. 계정 1 가입:
   http://localhost:3000/signup
   
   - 아이디: user001
   - 비밀번호: test1234
   - 이름: 테스트1
   - 생년월일: 900101-1
   - 전화: 010-1111-1111
   
3. 로그인:
   - 아이디: user001
   - 비밀번호: test1234
   → 성공! ✅

4. 로그아웃

5. 계정 2 가입:
   - 아이디: user002
   - 비밀번호: test1234
   - 이름: 테스트2
   - 생년월일: 900101-1
   - 전화: 010-1111-1111 (같은 번호!)
   
6. 로그인:
   - 아이디: user002
   - 비밀번호: test1234
   → 성공! ✅
```

---

## 🧪 M3 전체 플로우 테스트 (5분)

### 계정 1 (보호자)

#### Step 1: 케이스 생성
```
1. 로그인 (user001)
2. [+ 새 간병 등록] 클릭
3. 정보 입력:
   - 환자: 홍길동
   - 병원: 서울병원
   - 시작일: 오늘
   - 종료일: 7일 후
   - 1일 간병비: 150000
   - 간병인: 김간병
   - 연락처: 010-2222-2222
4. [저장]
```

#### Step 2: 보호자 계약 동의
```
1. 생성한 케이스 클릭
2. [계약서 동의] 버튼 클릭
3. 체크박스 동의
4. [동의하고 계속] 클릭
→ 간병인 초대 링크 표시됨 ✅
```

#### Step 3: 간병인 링크 복사
```
1. "간병인 초대 링크" 섹션에서
2. [링크 복사] 버튼 클릭
3. 클립보드에 링크 복사됨
→ 예: http://localhost:3000/caregiver/[토큰]
```

---

### 간병인 (시크릿 창)

#### Step 4: 간병인 링크 접속
```
1. Ctrl + Shift + N (시크릿 모드)
2. 복사한 링크 붙여넣기
3. 엔터
→ 간병인 매칭 동의 페이지 표시 ✅
```

#### Step 5: 간병인 정보 입력 및 동의
```
1. 성함: 김간병
2. 연락처: 010-2222-2222
3. 생년월일: 850722
4. 주소: 서울시 강남구
5. 은행: 국민은행
6. 계좌번호: 123456789
7. 체크박스 동의 ✓
8. [동의하고 시작하기] 클릭
→ 간병일지 페이지로 이동 ✅
```

#### Step 6: 간병일지 작성
```
1. 오늘 날짜 클릭
2. 체크박스:
   ✓ 식사 보조
   ✓ 체위 변경
   ✓ 투약
3. 메모: "환자 상태 양호합니다"
4. [저장] 클릭
→ 일지 목록으로 이동
→ 오늘 일지 "작성 완료" 표시 ✅
```

---

### 보호자 확인 (일반 창)

#### Step 7: 상태 확인
```
1. 일반 창으로 돌아가기
2. /cases 페이지 새로고침 (F5)
3. 케이스 상태 확인
→ "진행 중" 표시 ✅
```

#### Step 8: 간병일지 확인
```
1. 케이스 클릭
2. "간병일지" 섹션 확인
→ 오늘 일지 표시됨 ✅
```

---

## ✅ 성공 체크리스트

### 로그인:
- [ ] 계정 1 로그인 성공
- [ ] 계정 2 로그인 성공
- [ ] 계정 1/2 전환 가능

### 간병인 플로우:
- [ ] 링크 생성 성공
- [ ] 링크 복사 성공
- [ ] 간병인 페이지 접속 성공
- [ ] 간병인 동의 성공
- [ ] 상태 변경 (`IN_PROGRESS`)
- [ ] 간병일지 작성 성공
- [ ] 보호자가 일지 확인 가능

---

## 📊 M3 완료 기준

### 필수 (현재 구현됨):
- ✅ 간병인 링크 생성/복사
- ✅ 토큰 검증
- ✅ 간병인 정보 입력/동의
- ✅ 간병일지 작성

### 선택 (3차 고려):
- ⚠️ 간병인 휴대폰 인증 (보안 강화)
- ⚠️ 보호자 번호 뒤 4자리 2차 검증

---

## 🎯 결론

### 현재 상태:
**M3 기능은 거의 완성됨!** ✅

### 남은 작업:
1. **로그인 문제 해결** (SQL 실행)
2. **M3 전체 테스트** (위 시나리오)
3. **문제 발견 시 수정**

---

**다음 단계**:
1. ✅ Supabase SQL 실행 (테스트 계정 정리)
2. ✅ 새 계정 2개 가입
3. ✅ M3 전체 플로우 테스트
4. ✅ M4로 진행

---

**작성일**: 2025-12-07  
**예상 소요 시간**: 10분

