# 🧪 M3 전체 테스트 시나리오 (간병인 플로우)

## 📋 테스트 준비

### 1. 테스트 계정 정리 (Supabase SQL)
```sql
DELETE FROM cases;
DELETE FROM users;
DELETE FROM phone_otps WHERE used = true;
```

### 2. 새 계정 2개 준비
```
계정 A (보호자):
- 아이디: guardian1
- 비밀번호: test1234
- 전화: 010-1111-1111

계정 B (보호자):
- 아이디: guardian2
- 비밀번호: test1234
- 전화: 010-1111-1111 (같은 번호 OK!)
```

### 3. 브라우저 준비
```
일반 창: 계정 A (보호자)
시크릿 창: 간병인 역할
```

---

## ✅ Test 1: 간병인 링크 생성 (WP3.1)

### Step 1.1: 케이스 생성
**Given**: 계정 A 로그인  
**When**: 케이스 생성
```
환자: 홍길동
병원: 서울병원
시작일: 2025-12-08
종료일: 2025-12-15
1일 간병비: 150000
간병인: 김간병
연락처: 010-2222-2222
```
**Then**: 
- [ ] 케이스 생성 성공
- [ ] 목록에 표시
- [ ] 상태: "보호자 동의 대기"

### Step 1.2: 보호자 계약 동의
**When**: 케이스 클릭 → [계약서 동의] → 동의  
**Then**:
- [ ] 상태: "간병인 연결 대기"
- [ ] **간병인 초대 링크 섹션 표시**
- [ ] 링크 URL 표시

### Step 1.3: 링크 복사
**When**: [링크 복사] 버튼 클릭  
**Then**:
- [ ] "링크가 복사되었습니다" 메시지
- [ ] 클립보드에 URL 저장됨
- [ ] URL 형식: `http://localhost:3000/caregiver/[64자 토큰]`

---

## ✅ Test 2: 간병인 토큰 검증 (WP3.2)

### Step 2.1: 유효한 토큰 접속
**Given**: 복사한 간병인 링크  
**When**: 시크릿 창에서 링크 접속  
**Then**:
- [ ] 페이지 로드 성공
- [ ] 제목: "간병인 매칭 동의"
- [ ] 간병 내용 요약 표시:
  - 환자명: 홍길동
  - 병원: 서울병원
  - 기간: 2025-12-08 ~ 2025-12-15
  - 일당: 150,000원

### Step 2.2: 잘못된 토큰 접속
**Given**: 임의의 토큰  
**When**: `http://localhost:3000/caregiver/invalidtoken123` 접속  
**Then**:
- [ ] ⚠️ 아이콘 표시
- [ ] "링크 오류" 제목
- [ ] "유효하지 않은 링크입니다" 메시지

---

## ✅ Test 3: 간병인 동의 (WP3.3)

### Step 3.1: 정보 입력 및 동의
**Given**: 유효한 간병인 페이지  
**When**: 정보 입력
```
성함: 김간병
연락처: 010-2222-2222
생년월일: 850722
주소: 서울시 강남구 테헤란로 123
은행: 국민은행
계좌번호: 123456789012
체크박스: ✓ 동의
```
**When**: [동의하고 시작하기] 클릭  
**Then**:
- [ ] 간병일지 페이지로 리다이렉트 (`/caregiver/[token]/logs`)
- [ ] 날짜별 일지 목록 표시
- [ ] 상단: "간병일지" 제목

### Step 3.2: 이미 동의한 케이스 재접속
**Given**: 동의 완료된 케이스  
**When**: 같은 링크 다시 접속  
**Then**:
- [ ] "이미 동의 완료된 간병입니다" 메시지
- [ ] [간병일지 작성하러 가기] 버튼
- [ ] 버튼 클릭 → 일지 페이지로 이동

---

## ✅ Test 4: 간병일지 작성 (WP3.4)

### Step 4.1: 오늘 일지 작성
**Given**: 간병일지 목록 페이지  
**When**: 오늘 날짜 클릭  
**Then**:
- [ ] 일지 작성 페이지 표시
- [ ] 체크박스 5개 표시
- [ ] 메모 입력란 표시

**When**: 작성 후 저장
```
체크박스:
✓ 식사 보조
✓ 체위 변경
✓ 투약
메모: 환자 상태 양호합니다.
```
**Then**:
- [ ] 일지 목록으로 리다이렉트
- [ ] 오늘 날짜에 "작성 완료" 배지
- [ ] 작성 내용 미리보기 표시

### Step 4.2: 날짜 범위 검증
**Given**: 간병 기간 2025-12-08 ~ 2025-12-15  
**When**: 일지 목록에서 날짜 확인  
**Then**:
- [ ] 오늘부터 종료일까지만 표시
- [ ] 과거 날짜 표시 안 됨
- [ ] 미래 날짜 표시 안 됨

### Step 4.3: 일지 수정
**Given**: 작성 완료된 오늘 일지  
**When**: 오늘 날짜 다시 클릭  
**Then**:
- [ ] 기존 작성 내용 표시
- [ ] 수정 가능
- [ ] 저장 시 업데이트됨

---

## ✅ Test 5: 보호자 확인 (통합)

### Step 5.1: 케이스 상태 변경 확인
**Given**: 간병인 동의 완료  
**When**: 보호자 계정으로 케이스 목록 새로고침  
**Then**:
- [ ] 상태: "보호자 동의 대기" → "진행 중" 변경됨 ✅
- [ ] 배지 색상 변경 (주황 → 초록)

### Step 5.2: 간병일지 확인
**Given**: 간병인이 일지 작성 완료  
**When**: 케이스 상세 페이지 → 간병일지 섹션  
**Then**:
- [ ] 작성된 일지 표시
- [ ] 날짜, 내용 확인 가능
- [ ] "[수행 항목]" 섹션에 체크 항목 표시
- [ ] "[메모]" 섹션에 메모 내용 표시

---

## ✅ Test 6: 보안 테스트

### Step 6.1: 다른 보호자가 간병인 링크 접근
**Given**: 
- 계정 A의 간병인 링크 복사
- 계정 B로 로그인
**When**: 계정 B가 계정 A의 간병인 링크로 케이스 상세 접근 시도  
**Then**:
- [ ] 간병인 링크는 누구나 접근 가능 (토큰 기반)
- [ ] 하지만 보호자는 본인 케이스만 볼 수 있음

### Step 6.2: 케이스 소유권 검증
**Given**: 계정 A의 케이스 ID  
**When**: 계정 B가 `/cases/[A의ID]` 직접 접속  
**Then**:
- [ ] "권한이 없습니다" 메시지
- [ ] 케이스 정보 표시 안 됨

---

## 📊 테스트 결과 기록

### 실행 정보
- 실행일: ____________
- 실행자: ____________
- 브라우저: Chrome

### 결과
| Test Suite | 통과/전체 | 상태 |
|------------|-----------|------|
| Test 1: 링크 생성 | __/3 | ⬜ |
| Test 2: 토큰 검증 | __/2 | ⬜ |
| Test 3: 간병인 동의 | __/2 | ⬜ |
| Test 4: 간병일지 작성 | __/3 | ⬜ |
| Test 5: 보호자 확인 | __/2 | ⬜ |
| Test 6: 보안 테스트 | __/2 | ⬜ |
| **Total** | __/14 | ⬜ |

### 발견된 이슈
1. ____________________________________________
2. ____________________________________________

---

## ✅ M3 완료 조건

모든 테스트가 통과하면 M3 완료:
- [ ] 14개 테스트 모두 통과
- [ ] 보안 테스트 100% 통과
- [ ] 로그인 정상 작동
- [ ] 간병인 플로우 정상 작동

---

## 🎯 다음 단계

M3 완료 후:
1. ✅ M3 완료 보고서 작성
2. 🔄 Git commit & push
3. 🚀 M4 (운영자 대시보드) 시작

---

**작성일**: 2025-12-07  
**버전**: 1.0  
**단계**: M3 검증

