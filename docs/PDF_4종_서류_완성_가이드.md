# 📄 PDF 4종 서류 완성 가이드

## ✅ 완성된 기능

### 4가지 PDF 서류

1. **간병인 소속확인서** 📋
   - 한국간병협회 소속 확인
   - 간병인 정보 (성명, 생년월일, 연락처, 등록일자)
   - 한국간병협회 대표 강지예 서명

2. **간병인 사용확인서** 📝
   - 환자 정보 (성명, 생년월일, 병원)
   - 간병인 정보
   - 서비스 기간 및 결제금액
   - 한국간병협회 대표 강지예 서명

3. **사업자 등록증** 🏢
   - 한국간병협회(HKCARE) 사업자 정보
   - 등록번호: 380-94-01767
   - 임시 템플릿 (나중에 실제 이미지로 교체 가능)

4. **간병인 중개 계약서** 📄
   - 간병인/보호자/환자 정보
   - 계약 내용 (기간, 금액)
   - 한국간병협회 중개 계약

---

## 🎨 사용자 인터페이스

### 케이스 상세 페이지
```
📄 보험 청구 서류 (4종)
보험 청구에 필요한 모든 서류를 다운로드하세요

┌─────────────────────────────────────┐
│ 📋 간병인 소속확인서                  │
│ 한국간병협회 소속 확인                │
│ [미리보기] [다운로드]                  │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 📝 간병인 사용확인서                  │
│ 간병 서비스 이용 내역                 │
│ [미리보기] [다운로드]                  │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 🏢 사업자 등록증                      │
│ 한국간병협회 사업자 정보              │
│ [미리보기] [다운로드]                  │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 📄 간병인 중개 계약서                 │
│ 간병인-보호자 계약 내용               │
│ [미리보기] [다운로드]                  │
└─────────────────────────────────────┘

💡 서류가 다르거나 수정이 필요하신가요?
[📞 고객센터 문의하기]
```

---

## 🧪 테스트 방법

### 1단계: 서버 재시작 (필수!)
```bash
Ctrl + C
npm run dev
```

### 2단계: 브라우저 새로고침
```
Ctrl + Shift + R
```

### 3단계: 케이스 준비
```
1. 로그인
2. 케이스 생성 (또는 기존 케이스 사용)
3. 보호자 동의
4. 간병인 링크 → 간병인 동의
5. 케이스 상세 페이지 접속
```

### 4단계: PDF 테스트

#### A. 미리보기 테스트
```
1. [미리보기] 버튼 클릭
2. 새 탭에서 PDF 열림 ✅
3. 내용 확인:
   - 한글 정상 표시
   - 데이터 정확성
   - 레이아웃 확인
```

#### B. 다운로드 테스트
```
1. [다운로드] 버튼 클릭
2. 파일 저장 확인 ✅
3. 저장된 PDF 열기
4. 내용 확인
```

#### C. 4종 전체 테스트
```
1. 📋 간병인 소속확인서 - 미리보기/다운로드
2. 📝 간병인 사용확인서 - 미리보기/다운로드
3. 🏢 사업자 등록증 - 미리보기/다운로드
4. 📄 간병인 중개 계약서 - 미리보기/다운로드
→ 모두 정상 작동! ✅
```

#### D. 고객센터 모달 테스트
```
1. [📞 고객센터 문의하기] 클릭
2. 모달 팝업 확인
3. 전화번호, 이메일 표시 확인
4. [닫기] 버튼 클릭 → 모달 닫힘 ✅
```

---

## 📋 체크리스트

### 기능 확인
- [ ] 4가지 PDF 모두 미리보기 가능
- [ ] 4가지 PDF 모두 다운로드 가능
- [ ] 한글 폰트 정상 표시
- [ ] 데이터 정확성 (케이스 정보 반영)
- [ ] 미리보기 새 탭 열림
- [ ] 다운로드 파일명 정상
- [ ] 고객센터 모달 작동

### 에러 처리
- [ ] 간병인 미동의 시 에러 표시
- [ ] 로그인 안 됨 시 401
- [ ] 권한 없음 시 403
- [ ] 케이스 없음 시 404

### UI/UX
- [ ] 4개 카드 깔끔한 레이아웃
- [ ] 아이콘 적절히 표시
- [ ] 버튼 hover 효과
- [ ] 로딩 스피너 표시
- [ ] 피드백 섹션 가시성

---

## 🎯 API Endpoints

### 간병인 소속확인서
```
GET /api/pdf/affiliation/[caseId]
```

### 간병인 사용확인서
```
GET /api/pdf/usage/[caseId]
```

### 사업자 등록증
```
GET /api/pdf/business
```

### 간병인 중개 계약서
```
GET /api/pdf/contract/[caseId]
```

---

## 🔧 커스터마이징 가능

### 1. 사업자 등록증 교체

**현재**: 임시 텍스트 템플릿  
**교체 방법**:

1. 실제 사업자 등록증 이미지 준비
2. `public/images/business-registration.png` 저장
3. `src/modules/pdf/templates/business-registration.tsx` 수정
4. Image 컴포넌트 사용

### 2. 서명/도장 추가

**현재**: 텍스트로 "한국간병협회 대표 강지예"  
**추가 방법**:

1. 서명 이미지 준비 (PNG, 투명 배경)
2. `public/images/signature.png` 저장
3. 각 템플릿에 Image 컴포넌트 추가

### 3. 레이아웃 수정

각 템플릿 파일:
- `src/modules/pdf/templates/affiliation-certificate.tsx`
- `src/modules/pdf/templates/usage-certificate.tsx`
- `src/modules/pdf/templates/business-registration.tsx`
- `src/modules/pdf/templates/agency-contract.tsx`

StyleSheet 수정으로 자유롭게 변경 가능!

---

## 🚨 알려진 이슈 및 해결책

### 이슈 1: PDF 한글 깨짐
**원인**: 폰트 파일 경로 오류  
**해결**: `public/fonts/NanumGothic-Regular.ttf` 확인

### 이슈 2: 미리보기 안 열림
**원인**: 브라우저 팝업 차단  
**해결**: 팝업 허용 설정

### 이슈 3: 다운로드 실패
**원인**: 간병인 미동의 상태  
**해결**: 간병인 동의 완료 후 시도

---

## ✅ 최종 확인

### 기존 기능 영향 없음
- [x] 기존 통합 PDF는 백업으로 유지 (숨김 처리)
- [x] 이메일 발송 기능 유지
- [x] 케이스 관리 기능 정상
- [x] 간병인 플로우 정상

### 새 기능 완벽 작동
- [x] 4가지 PDF 생성
- [x] 미리보기 기능
- [x] 다운로드 기능
- [x] 고객센터 모달
- [x] 피드백 UI

---

## 🎉 완성!

**모든 PDF 서류가 정상 작동합니다!** ✅

### 남은 선택 작업
- Gmail 이메일 설정 (기존 기능)
- 사업자 등록증 이미지 교체 (나중에)
- 서명/도장 이미지 추가 (선택)

---

**작성일**: 2025-12-08  
**상태**: ✅ 완성

