# 📱 카카오 알림톡 템플릿 가이드 (WP2.4)

## 🎯 목적

M5 단계에서 알림톡 기능을 바로 사용할 수 있도록, **템플릿을 미리 승인**받습니다.
- 카카오 템플릿 검수 기간: 보통 2-5 영업일
- M2 단계에서 미리 신청하면 M5 개발 시 대기 시간 단축

---

## 📋 준비사항

### 1. Solapi 계정 준비
1. [Solapi 콘솔](https://solapi.com/) 회원가입
2. **발신번호 등록** (본인 휴대폰 번호)
   - 콘솔 → 발신번호 관리 → 발신번호 등록
   - 본인 인증 후 승인 (보통 즉시)
3. **충전**
   - 알림톡: 건당 약 8-15원
   - 테스트용으로 10,000원 정도 충전 권장

### 2. 카카오 발신 프로필 생성
1. Solapi 콘솔 → 카카오톡 → 발신 프로필 관리
2. **발신 프로필 생성** 클릭
3. 정보 입력:
   - 프로필 이름: `간병노트` (서비스명)
   - 프로필 설명: `가족 간병 서류 관리 서비스`
   - 카테고리: `생활/서비스 > 기타`
4. **검수 신청** → 승인 대기 (1-3 영업일)

---

## 📝 템플릿 3종 작성

### ✅ 템플릿 1: 간병 시작 안내

**템플릿 이름**: `간병_시작_안내`

**템플릿 코드**: `CARE_START`

**카테고리**: `정보성 메시지`

**템플릿 내용**:
```
[간병노트] 간병이 시작되었습니다

안녕하세요, #{보호자_이름}님.
#{환자_이름}님의 간병이 #{시작일}부터 시작되었습니다.

📋 간병 정보
• 환자: #{환자_이름}
• 병원: #{병원명}
• 기간: #{시작일} ~ #{종료일}
• 간병비: #{일당}원/일

간병인과 원활한 소통을 위해 간병일지를 매일 확인해주세요.

▶ 케이스 상세보기
#{케이스_링크}
```

**강조 유형**: `TEXT`

**버튼**:
- 버튼명: `케이스 확인하기`
- 버튼 타입: `웹 링크`
- URL: `https://yourdomain.com/cases/#{케이스_아이디}`

---

### ✅ 템플릿 2: 간병인 링크 안내

**템플릿 이름**: `간병인_링크_발송`

**템플릿 코드**: `CAREGIVER_INVITE`

**카테고리**: `정보성 메시지`

**템플릿 내용**:
```
[간병노트] 간병인 참여 링크를 보내드립니다

#{보호자_이름}님이 요청하신 간병인 참여 링크입니다.

📱 간병인 전달 방법
아래 링크를 간병인에게 전달해주세요.
간병인은 휴대폰 인증만으로 간병일지를 작성할 수 있습니다.

⚠️ 주의사항
• 링크는 보안을 위해 #{유효기간}까지 유효합니다
• 링크를 분실하신 경우 케이스 페이지에서 재발송 가능합니다

▶ 간병인 참여 링크
#{간병인_링크}

▶ 내 케이스 관리
#{케이스_링크}
```

**강조 유형**: `TEXT`

**버튼**:
- 버튼 1:
  - 버튼명: `간병인 링크 복사`
  - 버튼 타입: `웹 링크`
  - URL: `#{간병인_링크}`
- 버튼 2:
  - 버튼명: `케이스 관리`
  - 버튼 타입: `웹 링크`
  - URL: `https://yourdomain.com/cases/#{케이스_아이디}`

---

### ✅ 템플릿 3: 간병 종료 및 서류 발급 안내

**템플릿 이름**: `간병_종료_서류발급`

**템플릿 코드**: `CARE_END_DOCS`

**카테고리**: `정보성 메시지`

**템플릿 내용**:
```
[간병노트] 간병이 종료되었습니다

#{보호자_이름}님, #{환자_이름}님의 간병이 종료되었습니다.

📋 간병 요약
• 환자: #{환자_이름}
• 병원: #{병원명}
• 기간: #{시작일} ~ #{종료일}
• 총 #{일수}일

📄 서류 발급 안내
보험 청구 또는 회사 제출을 위한 서류를 발급받으실 수 있습니다.

• 간병 계약서
• 간병일지
• 비용 지급 확인서

아래 버튼을 눌러 서류를 이메일로 받으실 수 있습니다.

▶ 서류 발급하기
#{서류_발급_링크}
```

**강조 유형**: `TEXT`

**버튼**:
- 버튼명: `서류 발급하기`
- 버튼 타입: `웹 링크`
- URL: `https://yourdomain.com/cases/#{케이스_아이디}#documents`

---

## 🔧 템플릿 등록 방법

### 1. Solapi 콘솔에서 등록
1. Solapi 콘솔 로그인
2. **카카오톡** → **템플릿 관리** 메뉴
3. **템플릿 추가** 클릭
4. 위 템플릿 내용을 **정확히** 복사 붙여넣기
   - `#{변수명}` 형식은 그대로 유지
   - 띄어쓰기, 줄바꿈 정확히 맞추기
5. 버튼 정보 입력
6. **검수 신청** 클릭

### 2. 검수 진행 상태 확인
- **검수 중**: 대기 (1-3 영업일)
- **승인 완료**: 사용 가능
- **반려**: 사유 확인 후 수정 재신청

### 3. 검수 반려 시 주의사항
자주 반려되는 이유:
- ❌ 광고성 문구 포함
- ❌ 불명확한 발신자 정보
- ❌ 개인정보 수집 관련 문구
- ❌ URL 단축 서비스 사용

---

## 💾 환경 변수 설정

템플릿 승인 후, `.env.local`에 추가:

```bash
# Solapi 설정
NEXT_PUBLIC_SOLAPI_API_KEY=your_api_key_here
NEXT_PUBLIC_SOLAPI_API_SECRET=your_api_secret_here
SOLAPI_SENDER_PHONE=01012345678  # 발신번호

# 카카오 템플릿 코드 (승인 후 받은 코드)
KAKAO_TEMPLATE_CARE_START=CARE_START
KAKAO_TEMPLATE_CAREGIVER_INVITE=CAREGIVER_INVITE
KAKAO_TEMPLATE_CARE_END_DOCS=CARE_END_DOCS
```

---

## 📊 M5 단계 준비 완료 체크리스트

- [ ] Solapi 계정 생성 및 충전
- [ ] 발신번호 등록 및 승인
- [ ] 카카오 발신 프로필 생성 및 승인
- [ ] 템플릿 1: 간병 시작 안내 → 승인 완료
- [ ] 템플릿 2: 간병인 링크 안내 → 승인 완료
- [ ] 템플릿 3: 간병 종료 서류 발급 → 승인 완료
- [ ] 환경 변수 설정 완료

---

## 🚨 주의사항

### 1. 템플릿 변수 규칙
- 변수는 반드시 `#{변수명}` 형식 사용
- 실제 발송 시 코드에서 변수값 매핑 필수
- 변수명은 한글/영문 모두 가능하지만 일관성 유지

### 2. 개인정보 보호
- 주민등록번호, 계좌번호 등 민감정보는 템플릿에 포함 금지
- 환자명, 병원명 정도만 포함

### 3. 비용 관리
- 알림톡: 건당 8-15원 (발송 성공 시에만 과금)
- 발송 실패 시 SMS 대체 발송 (건당 20-30원)
- 월 예상 발송량 × 15원으로 예산 계산

### 4. 테스트 발송
- 템플릿 승인 후 **반드시 테스트 발송** 확인
- 변수 치환이 제대로 되는지 확인
- 링크 클릭 시 정상 작동하는지 확인

---

## 🔗 관련 문서

- [Solapi 카카오 알림톡 가이드](https://solapi.com/docs/kakao)
- [카카오 비즈 메시지 정책](https://business.kakao.com/info/biztalk)

---

**작성일**: 2025-12-07  
**단계**: M2 WP2.4  
**다음 단계**: M5에서 실제 발송 로직 구현

