# M1 – 계정/인증/유저 기본 레이어 시나리오

## WP1.1 – 휴대폰 문자 인증 로그인/회원가입 (+ RateLimit)

### Scenario WP1.1-1: 휴대폰 인증 및 최초 회원가입 성공
- Given:  
  - 아직 가입되지 않은 휴대폰 번호가 있다.
- When:  
  - `/auth/phone`에서 해당 번호를 입력하고 [인증번호 받기] → 수신한 코드 입력 후 [인증 확인] 버튼을 누른다.
- Then:  
  - 신규 유저가 생성되고, 로그인 상태가 되어 `/cases` 페이지로 이동한다.
- 선행 Scenario: WP0.2-1  
- 테스트/검증:  
  - 인증 완료 후 `/cases` 도달 확인.  
  - Supabase `users` 테이블에서 새 row 생성 확인.

---

### Scenario WP1.1-2: 기존 회원 휴대폰 재인증 로그인 성공
- Given:  
  - 이미 `users` 테이블에 등록된 휴대폰 번호가 있다.
- When:  
  - `/auth/phone`에서 동일 번호로 인증번호 요청 → 인증번호 입력/확인.
- Then:  
  - 새로운 회원이 생성되지 않고, 기존 유저로 로그인되어 `/cases`로 이동한다.
- 선행 Scenario: WP1.1-1  
- 테스트/검증:  
  - 로그인 후 `users` row 개수가 증가하지 않았는지 확인.

---

### Scenario WP1.1-3: 잘못된 인증번호 입력 실패
- Given:  
  - 특정 휴대폰 번호로 인증번호가 발송된 상태.
- When:  
  - 잘못된 6자리 코드를 입력하고 [인증 확인]을 누른다.
- Then:  
  - “인증 실패” 메시지가 표시되고, 로그인/회원가입이 진행되지 않는다.
- 선행 Scenario: WP1.1-1  
- 테스트/검증:  
  - UI 에러 메시지 확인.  
  - `users`에 새로운 row 미생성 확인.

---

### Scenario WP1.1-4: 만료된 인증번호 사용 실패
- Given:  
  - 발급받은 인증번호가 만료 시간(예: 5분) 이후가 된 상태.
- When:  
  - 해당 인증번호를 입력하고 [인증 확인] 버튼을 누른다.
- Then:  
  - “인증번호가 만료되었습니다” 등의 메시지가 표시되고 로그인되지 않는다.
- 선행 Scenario: WP1.1-1  
- 테스트/검증:  
  - 만료 시간을 짧게 설정 후 테스트.  
  - 만료 후 시도 시 로그인/redirect가 발생하지 않는지 확인.

---

### Scenario WP1.1-5: RateLimit 초과로 인증번호 발송 실패
- Given:  
  - 동일 번호로 이미 여러 차례(예: 1분 내 1회 이상) 인증번호 요청을 한 상태.
- When:  
  - 같은 번호로 다시 [인증번호 받기] 버튼을 누른다.
- Then:  
  - “요청이 너무 잦습니다. 잠시 후 다시 시도해주세요.” 를 표시하고, 새로운 문자 발송을 하지 않는다.
- 선행 Scenario: WP1.1-1  
- 테스트/검증:  
  - 같은 번호로 연속 요청 후 에러 메시지 확인.  
  - Solapi 발송 로그/크레딧이 추가로 차감되지 않았는지 확인.

---

## WP1.2 – 프로필(/profile) 조회/수정

### Scenario WP1.2-1: 내 프로필 조회 성공
- Given:  
  - 정상적으로 로그인된 보호자 계정이 있다.
- When:  
  - `/profile` 페이지에 접속한다.
- Then:  
  - 로그인된 사용자의 이름, 생년월일, 이메일, 전화번호가 올바르게 표시된다.
- 선행 Scenario: WP1.1-1  
- 테스트/검증:  
  - UI에서 각 필드가 DB와 일치하는지 확인.

---

### Scenario WP1.2-2: 내 프로필 정보 수정 성공
- Given:  
  - 로그인된 상태에서 `/profile`에 접속해 있다.
- When:  
  - 이름 또는 이메일 값을 수정하고 [저장] 버튼을 누른다.
- Then:  
  - 저장 성공 메시지가 표시되고, 새로고침해도 수정된 값이 유지된다.
- 선행 Scenario: WP1.2-1  
- 테스트/검증:  
  - 저장 후 새로고침 → 수정된 값 표시 확인.  
  - `users` 테이블에서 수정된 값 확인.

---

### Scenario WP1.2-3: 전화번호는 수정 불가
- Given:  
  - 로그인된 상태에서 `/profile`에 접속해 있다.
- When:  
  - 전화번호 필드를 클릭/수정하려고 시도한다.
- Then:  
  - 입력 불가 상태이거나 저장 시도 후에도 DB 반영이 되지 않는다.
- 선행 Scenario: WP1.2-1  
- 테스트/검증:  
  - UI에서 read-only 여부 확인.  
  - 수정 후 저장 시도 → DB 값 그대로인지 확인.

---

## WP1.3 – role 구조 & /admin 접근 제한

### Scenario WP1.3-1: 일반 보호자의 /admin 접근 차단
- Given:  
  - `role='guardian'` 인 계정이 로그인된 상태.
- When:  
  - `/admin` URL에 접속한다.
- Then:  
  - “접근 권한이 없습니다” 등의 메시지 또는 403 페이지가 표시된다.
- 선행 Scenario: WP1.1-1  
- 테스트/검증:  
  - 브라우저에서 `/admin` 접속 → 차단 메시지 확인.

---

### Scenario WP1.3-2: Admin 계정의 /admin 접근 성공
- Given:  
  - `role='admin'` 으로 설정된 계정이 로그인된 상태.
- When:  
  - `/admin` URL에 접속한다.
- Then:  
  - “Admin Home” 또는 어드민 홈 화면이 표시된다.
- 선행 Scenario: WP1.3-1  
- 테스트/검증:  
  - admin 계정으로 로그인 후 `/admin` 접속 → 홈 화면 확인.
