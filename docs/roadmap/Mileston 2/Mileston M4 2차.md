# M4 – 운영자(Admin) 대시보드 & 운영 도구

## 🎯 목표
- 운영자가 `/admin`에서 전체 케이스를 관리할 수 있고,
- 날짜/상태 꼬임을 직접 정리할 수 있는 도구 확보.

---

## ✅ WP4.1 – `/admin/cases` 전체 케이스 목록

**목표**  
운영자가 전체 케이스 리스트를 보는 기본 화면.

**작업 내용**
- `/admin/cases`:
  - admin 전용.
  - 모든 `cases`를 테이블로 표시.
  - 컬럼: 보호자 이름/전화, 환자명, 병원명, 기간, 상태.
  - 검색/필터: 환자명, 병원명, 상태.

**완료 & 테스트**
- admin 계정 → 전체 케이스 조회 가능.
- 보호자 계정 → 접근 차단.

---

## ✅ WP4.2 – `/admin/cases/[id]` 상세 + 활동 로그 탭

**목표**  
운영자가 한 케이스의 상태/변경 이력을 한눈에 볼 수 있는 상태.

**작업 내용**
- `activity_logs` 테이블:
  - `id`, `user_id`, `case_id`, `action`, `meta(jsonb)`, `created_at`.
- `/admin/cases/[id]`:
  - 케이스 상세 정보.
  - “활동 로그” 탭:
    - 해당 케이스의 `activity_logs`를 시간순 리스트.

**완료 & 테스트**
- 수동 로그 추가 후 로그 탭에서 노출 확인.
- 케이스 상세+로그가 함께 잘 보이는지 확인.

---

## ✅ WP4.3 – 기간 수정·강제 종료 + 로그 기록

**목표**  
운영자가 잘못된 기간/상태를 직접 수정하고, 이력을 남길 수 있는 상태.

**작업 내용**
- `/admin/cases/[id]`:
  - [기간 수정] 버튼:
    - 과거 포함 임의 날짜로 수정.
    - `activity_logs`에 `action='CHANGE_PERIOD'`, meta에 이전/이후 값 기록.
  - [강제 종료] 버튼:
    - 상태를 `ended_early` / `canceled` 등으로 변경.
    - `activity_logs`에 `action='FORCE_END'`, 사유/이전 상태 기록.

**완료 & 테스트**
- 일부러 이상 기간/상태를 만든 케이스 → 수정/강제 종료로 정상화.
- 로그 탭에서 변경 이력 확인.

---

## ✅ WP4.4 – 운영자 케이스 삭제 (Hard Delete + Confirm)

**목표**  
운영자가 케이스 및 연관 데이터를 완전히 삭제하되, 실수는 방지.

**작업 내용**
- FK:
  - `cases` 삭제 시, 관련 테이블은 `ON DELETE CASCADE`.
- `/admin/cases/[id]`:
  - [케이스 완전 삭제] 버튼:
    - Confirm 모달:
      - “이 케이스와 관련된 모든 데이터(일지, 링크, 알림 로그)가 완전히 삭제되며 복구할 수 없습니다. 삭제하시겠습니까?”
      - [취소] / [정말 삭제하기(빨간색)]
    - [정말 삭제하기] 선택 시:
      - `cases` Hard Delete.
      - 삭제 직전에 `activity_logs`에 `action='DELETE_CASE'` 기록.

**완료 & 테스트**
- 연관 데이터가 있는 케이스 삭제 → 모두 제거되는지 확인.
- Confirm 없이 삭제되지 않는지 확인.
