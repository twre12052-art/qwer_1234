# M2 – 보호자 플로우 MVP 시나리오

## WP2.1 – 내 케이스 목록

### Scenario WP2.1-1: 케이스가 없는 보호자의 목록 화면
- Given:  
  - 로그인된 보호자 계정이 있고, `cases` 테이블에 해당 guardian_id의 케이스가 없다.
- When:  
  - `/cases` 페이지에 접속한다.
- Then:  
  - “등록된 케이스가 없습니다.” 와 같은 안내 문구가 표시된다.
- 선행 Scenario: WP1.1-1  
- 테스트/검증:  
  - 해당 guardian_id 케이스 삭제 후 `/cases` 접속.

---

### Scenario WP2.1-2: 케이스가 있는 보호자의 목록 화면
- Given:  
  - 로그인된 보호자 계정이 있고, `cases` 테이블에 guardian_id로 1건 이상 케이스가 존재한다.
- When:  
  - `/cases` 페이지에 접속한다.
- Then:  
  - 각 케이스가 카드 형태로 목록에 표시된다.
- 선행 Scenario: WP2.2-1  
- 테스트/검증:  
  - 케이스 생성 후 `/cases` 접속 → 목록 표시 확인.

---

### Scenario WP2.1-3: 다른 계정의 케이스는 보이지 않음
- Given:  
  - A 보호자 계정과 B 보호자 계정이 있고, 각 계정에 다른 케이스가 등록된 상태.
- When:  
  - A 계정으로 로그인 후 `/cases`에 접속한다.
- Then:  
  - B의 케이스는 목록에 표시되지 않는다.
- 선행 Scenario: WP2.2-1 (두 계정 케이스 생성)  
- 테스트/검증:  
  - A/B 각각 로그인 → 서로 케이스 미표시 확인.

---

## WP2.2 – 케이스 생성 폼

### Scenario WP2.2-1: 유효한 정보로 케이스 생성 성공
- Given:  
  - 오늘 날짜 기준, 시작일/종료일을 올바르게 선택 가능한 상태.
- When:  
  - 환자명, 병원명, 시작일(오늘 또는 미래), 종료일(시작일 이후)을 입력하고 [저장]을 누른다.
- Then:  
  - `cases` 테이블에 새 row가 생성되고, `/cases` 목록에서 해당 케이스가 보인다.
- 선행 Scenario: WP2.1-1  
- 테스트/검증:  
  - 폼 제출 후 `/cases` 목록 + `cases` 테이블 확인.

---

### Scenario WP2.2-2: 과거 시작일 선택 시 생성 실패
- Given:  
  - 오늘이 2025-12-06이라 가정.
- When:  
  - 시작일을 2025-12-05(어제)로 선택 후 [저장]을 누른다.
- Then:  
  - 에러 메시지를 표시하며 케이스가 생성되지 않는다.
- 선행 Scenario: 없음  
- 테스트/검증:  
  - UI 에러 메시지 확인.  
  - `cases` 테이블에 row 미생성 확인.

---

### Scenario WP2.2-3: 종료일이 시작일보다 빠른 경우 생성 실패
- Given:  
  - 시작일을 2025-12-10, 종료일을 2025-12-09로 선택한 상태.
- When:  
  - [저장] 버튼을 누른다.
- Then:  
  - “종료일은 시작일 이후여야 합니다” 등 에러 메시지, 케이스 미생성.
- 선행 Scenario: 없음  
- 테스트/검증:  
  - UI/서버 에러 확인, `cases`에 row 미추가 확인.

---

## WP2.3 – 케이스 상세 화면

### Scenario WP2.3-1: 내 케이스 상세 조회 성공
- Given:  
  - 로그인된 보호자 계정에 속한 케이스가 존재한다.
- When:  
  - `/cases/[id]` URL(목록에서 카드 클릭)을 통해 상세 페이지로 진입한다.
- Then:  
  - 해당 케이스의 환자명, 병원명, 기간, 상태, 액션 버튼들이 표시된다.
- 선행 Scenario: WP2.2-1  
- 테스트/검증:  
  - 목록 → 카드 클릭 → 상세 내용 확인.

---

### Scenario WP2.3-2: 다른 사람 케이스 상세 접근 실패
- Given:  
  - A 계정의 케이스 ID를 알고 있는 B 계정이 있다.
- When:  
  - B 계정으로 로그인 후 `/cases/[A의 id]`에 접속한다.
- Then:  
  - “접근 권한이 없습니다” 혹은 404/403과 같은 에러 화면이 표시된다.
- 선행 Scenario: WP2.1-3  
- 테스트/검증:  
  - A/B 계정 각각 로그인하여 URL 직접 입력 테스트.

---

## WP2.4 – 카카오 알림톡 템플릿 준비

### Scenario WP2.4-1: 알림톡 템플릿 등록 신청 성공
- Given:  
  - 카카오 비즈/솔라피 콘솔 계정이 있고, 발신 프로필이 승인된 상태.
- When:  
  - 시작 안내, 링크 안내, 종료 안내에 대한 템플릿을 작성하여 콘솔에 등록/검수 요청한다.
- Then:  
  - 템플릿 상태가 “검수 중” 또는 “승인됨”으로 표시된다.
- 선행 Scenario: 없음  
- 테스트/검증:  
  - 콘솔 화면에서 각 템플릿의 상태값 확인.

---

## WP2.5 – 보호자 케이스 삭제 (Hard Delete + Confirm)

### Scenario WP2.5-1: 삭제 Confirm에서 취소 선택
- Given:  
  - `/cases/[id]` 상세 화면에서 [케이스 삭제] 버튼이 보이는 상태.
- When:  
  - [케이스 삭제] 클릭 → Confirm 모달에서 [취소] 버튼을 누른다.
- Then:  
  - 삭제 요청이 서버로 전송되지 않고, 케이스는 그대로 남아 있다.
- 선행 Scenario: WP2.3-1  
- 테스트/검증:  
  - `cases` 테이블 row 수 변동 없음 확인.

---

### Scenario WP2.5-2: 삭제 Confirm에서 최종 삭제 선택
- Given:  
  - `cases` 및 연관 테이블(`care_logs`, `case_tokens`, `notification_logs`, `activity_logs`)에 해당 케이스 관련 데이터가 존재한다.
- When:  
  - [케이스 삭제] → Confirm 모달에서 [정말 삭제하기]를 누른다.
- Then:  
  - `cases` 해당 row 및 연관 row가 모두 삭제되고, `/cases` 목록에서 사라진다.
- 선행 Scenario: WP2.5-1  
- 테스트/검증:  
  - 목록에서 사라지는지 확인.  
  - 각 테이블에서 해당 case_id 검색 → 결과 없음 확인.
