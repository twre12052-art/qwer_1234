# M2 – 보호자 플로우 MVP (+ 카카오 템플릿 + 삭제 Confirm)

## 🎯 목표
- 보호자: 로그인 → 케이스 생성/조회/삭제까지 가능한 상태.
- 카카오 알림톡 템플릿을 미리 준비해 M5에서 바로 사용할 수 있게 한다.

---

## ✅ WP2.1 – “내 케이스 목록(비어 있어도)” 페이지

**목표**  
`/cases`에서 내 케이스 리스트를 볼 수 있는 기본 화면.

**작업 내용**
- `cases` 테이블:
  - `id`, `guardian_id`, `patient_name`, `hospital_name`,  
    `start_date`, `end_date_planned`, `end_date_final`,  
    `status`, `created_at`, `updated_at`
- RLS:
  - `guardian_id = auth.uid()` 인 row만 접근 허용.
- `/cases` 페이지:
  - 로그인 필요.
  - 내 케이스 카드 리스트.
  - 없으면 “등록된 케이스가 없습니다.” 안내.

**완료 & 테스트**
- 내 계정에서만 내 케이스 보이는지 확인.
- 다른 계정에서 서로 데이터 안 보이는지 확인.

---

## ✅ WP2.2 – 케이스 생성 폼 (날짜 검증 포함)

**목표**  
보호자가 새 케이스를 생성할 수 있는 상태.

**작업 내용**
- `/cases`에 [새 간병 케이스 만들기] 버튼.
- 생성 폼:
  - 환자명, 병원명, 시작일, 종료일.
  - 모바일 친화적인 입력/버튼 크기.
- 검증:
  - zod + 서버:
    - 시작일 ≥ 오늘.
    - 종료일 ≥ 시작일.
- 저장:
  - `guardian_id = auth.uid()`로 `cases` insert.
  - 완료 후 `/cases` 리다이렉트.

**완료 & 테스트**
- 정상 생성 → 목록에 나타남.
- 잘못된 날짜 입력 → UI/서버에서 모두 거부.

---

## ✅ WP2.3 – 케이스 상세 화면 + 액션 버튼 자리 만들기

**목표**  
보호자가 케이스 상세 내용을 보고,  
향후 기능 버튼 위치를 확인할 수 있는 상태.

**작업 내용**
- `/cases/[id]`:
  - 케이스 기본 정보 표시.
  - 액션 버튼:
    - [간병인 링크 생성] (M3)
    - [연장 요청] (M4)
    - [조기 종료 요청] (M4)
    - [케이스 삭제] (WP2.5)
    - [서류 발급하기] (M5)
- 권한:
  - 남의 케이스 접근 시 권한 에러.

**완료 & 테스트**
- 내 케이스만 접근 가능.
- 버튼 레이아웃/텍스트가 모바일 기준으로 자연스러운지 확인.

---

## ✅ WP2.4 – 카카오 알림톡 템플릿 문구 확정 + 검수 신청

**목표**  
2차 후반에 개발할 알림 기능 준비를 위해 템플릿을 미리 승인받는다.

**작업 내용**
- 템플릿 문구 3종 작성:
  1. 간병 시작 안내.
  2. 간병인 링크 안내/재발송.
  3. 종료/조기 종료 후 서류 발급 안내.
- Solapi/카카오 비즈 콘솔:
  - 템플릿 등록.
  - 검수 신청.

**완료 & 테스트**
- 콘솔에서 템플릿 상태: “검수 중” 또는 “승인됨”.

---

## ✅ WP2.5 – 보호자 케이스 삭제 (Hard Delete + Confirm)

**목표**  
복구 기능 없이도, 실수 방지 Confirm을 거쳐 케이스를 완전히 삭제.

**작업 내용**
- FK:
  - `cases` 부모,  
    `care_logs`, `case_tokens`, `notification_logs`, `activity_logs` 등은  
    `ON DELETE CASCADE`.
- `/cases/[id]`에서 [케이스 삭제] 버튼:
  - 클릭 시 중앙 Confirm 모달:
    - “삭제하면 데이터를 복구할 수 없습니다. 정말 삭제하시겠습니까?”
    - [취소] / [정말 삭제하기(빨간색)]
  - [정말 삭제하기] 선택 시에만 삭제 API 호출.
  - 삭제 후 `/cases` 이동 + “삭제 완료” 토스트.

**완료 & 테스트**
- 케이스 + 연관 데이터 생성 → 삭제 시 모두 제거되는지 확인.
- Confirm 없이 단일 클릭으로 삭제되지 않음을 확인.
