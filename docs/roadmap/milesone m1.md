# M1 – 보호자 플로우 1차  
> 로그인 · 케이스 생성 · 계약 동의 · 기간 변경

---

## M1-WP1. 보호자 Auth + 빈 케이스 목록

**사용자 가치**  
보호자가 서비스에 로그인해서, 자신의 케이스 목록 화면까지 접근할 수 있다.

**Scope**  
- `/login` 페이지
  - 이메일/비밀번호 입력
  - 회원가입 / 로그인 / 로그아웃
- 로그인 성공 시 `/cases`로 이동
- `/cases` 페이지
  - 로그인한 보호자 기준 본인 케이스 리스트(초기에는 빈 상태)
  - “새 간병 등록” 버튼 노출

**완료 기준**  
- 새 계정으로 회원가입 → 로그인 → “내 케이스가 없습니다” 화면 노출
- 로그인 안 한 상태에서 `/cases` 접속 시 `/login`으로 리다이렉트

---

## M1-WP2. 새 케이스 생성 & 상세 보기(계약 전)

**사용자 가치**  
보호자가 이번 간병에 대한 기본 정보를 앱에 등록할 수 있다.

**Scope**  
- `/cases/new`
  - 환자 이름, 병원, 시작일, 종료 예정일, 1일 간병비
  - 간병인 이름, 간병인 연락처 입력
  - 필수값/날짜 형식 기본 검증
- `createCase` 서버 액션
  - `cases` 레코드 생성
  - 상태: `GUARDIAN_PENDING`
- 생성 후 `/cases/[id]` 상세로 이동
- `/cases/[id]` 상세 페이지(계약 전)
  - 케이스 요약 정보 표시
  - “계약서 확인/동의하기” 버튼 노출

**완료 기준**  
- 새 케이스 입력 → 저장 → 상세 화면에서 정보 확인 가능
- `/cases` 목록에 새 케이스가 카드로 보임

---

## M1-WP3. 계약서 확인/동의 플로우 + 링크 활성화

**사용자 가치**  
보호자가 계약서를 확인·동의한 뒤에만 간병인에게 링크를 보낼 수 있다.

**Scope**  
- `/cases/[id]/agreement` 페이지
  - 케이스 요약 + 계약서 텍스트
  - “내용을 확인했습니다” 체크박스
  - [동의합니다] 버튼
- `agreeGuardian` 서버 액션
  - `guardian_agreed_at` 저장
  - `status: GUARDIAN_PENDING → CAREGIVER_PENDING`
- 동의 전
  - 케이스 상세에서 “계약 동의 후 링크 노출” 안내
- 동의 후
  - `case_tokens` 생성
  - 케이스 상세에서 간병인 링크 표시 + 복사 버튼 활성화

**완료 기준**  
- 보호자: 케이스 생성 → 계약서 동의 → 상세 화면에서 링크 확인 가능
- DB: `guardian_agreed_at`, `status`, `case_tokens` 값이 정상 저장

---

## M1-WP4. 조기 종료/연장 플로우

**사용자 가치**  
보호자가 실제 상황에 맞게 간병 기간을 조정할 수 있다.

**Scope**  
- `/cases/[id]` 상세에 버튼 추가
  - [간병 조기 종료]
  - [간병 연장]
- 조기 종료
  - 종료일 선택(오늘/과거)
  - 확인 모달(“간병인과 협의하셨나요?”)
  - `endCaseEarly` 서버 액션
    - `end_date_final` 설정
    - 종료일 이후 `care_logs` `is_active = false` 처리
- 연장
  - 새 종료일 선택(기존보다 뒤)
  - `extendCase` 서버 액션
    - `end_date_final` 수정

**완료 기준**  
- UI에서 조기 종료/연장 후, 상세 화면의 기간 정보가 변경됨
- 이후 M2에서 간병인 화면에 동일한 기간이 반영될 수 있는 데이터 상태 확보

---

## M1-WP5. M1 기본 에러/검증 마감

**사용자 가치**  
잘못된 입력이나 상태에서도 이유를 이해하고 다시 시도할 수 있다.

**Scope**  
- 회원가입
  - 이미 존재하는 이메일일 때 에러 메시지
- 로그인
  - 아이디/비밀번호 불일치 시 에러 메시지
- 케이스 생성/수정
  - 필수 필드 누락 시 폼 검증 에러
  - 시작일 > 종료 예정일 입력 시 에러
- 계약 동의
  - 체크박스 미체크 시 동의 버튼 비활성화 또는 에러 안내

**완료 기준**  
- 정상 플로우는 끊김 없이 동작
- 대표적인 오입력 케이스에서 “무슨 문제인지” 안내 표시
