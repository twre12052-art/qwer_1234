# M2 – 간병인 플로우 1차  
> 토큰 링크 · 간병인 동의 · 간병일지 작성

---

## M2-WP1. 토큰 링크 진입 & 유효성 체크

**사용자 가치**  
간병인이 링크를 눌렀을 때, 이 링크가 정상인지 바로 알 수 있다.

**Scope**  
- `/caregiver/[token]` 페이지 기본 레이아웃
- `getCaseByToken` 서버 액션
  - `case_tokens`에서 토큰 조회
  - 만료 여부 체크
  - 매칭되는 `cases` 조회
- 화면 분기
  - 유효 토큰: 케이스 요약 + 동의 안내
  - 무효/만료 토큰: “유효하지 않은 링크입니다” 안내 페이지

**완료 기준**  
- 정상 토큰 접속 시 케이스 요약이 보임
- 잘못된/만료된 토큰 접속 시 에러 안내 화면 노출

---

## M2-WP2. 간병인 정보 입력 + 동의

**사용자 가치**  
간병인이 본인 정보로 간병을 수락하고, 케이스를 확정할 수 있다.

**Scope**  
- `/caregiver/[token]`에서 동의 폼
  - 간병 내용 요약(환자, 병원, 기간, 일당)
  - 간병인 정보(이름, 연락처, 주민번호, 주소, 은행, 계좌)
  - 동의 체크박스 + [동의하고 시작하기] 버튼
- `agreeCaregiver` 서버 액션
  - `cases` 테이블에 간병인 정보 업데이트
  - `caregiver_agreed_at` 저장
  - `status: CAREGIVER_PENDING → IN_PROGRESS`
- 이미 동의한 상태에서 재접속 시
  - 동의 폼 대신 “이미 동의 완료, 일지 작성으로 이동” 안내 및 버튼

**완료 기준**  
- 간병인이 동의 후 재접속하면 바로 일지 화면으로 이동할 수 있음
- 보호자 화면에서 간병인 정보와 동의 완료 상태를 확인할 수 있음

---

## M2-WP3. 간병일지 목록 & 오늘 일지 작성

**사용자 가치**  
간병인이 하루 단위로 간단히 간병일지를 기록할 수 있다.

**Scope**  
- `/caregiver/[token]/logs`
  - 케이스 기간(시작일~오늘 또는 종료일) 기준 날짜 리스트
  - 각 날짜별 작성 상태(작성/미작성) 표시
  - “오늘 일지 작성하기” 버튼
- `/caregiver/[token]/logs/[date]`
  - 체크박스(식사 보조, 체위 변경, 투약, 이동 도움, 배변/배뇨 도움 등)
  - 메모 텍스트 영역
  - [저장] 버튼
- `createOrUpdateDailyLog` 서버 액션
  - 해당 날짜 `care_logs` 생성 또는 수정

**완료 기준**  
- 간병인: 링크 → 동의 → 오늘 일지 작성 → 목록에서 “작성완료”로 표시
- 보호자: 케이스 상세에서 일지 작성 개수/상태를 확인할 수 있음(간단 요약)

---

## M2-WP4. 기간 변경 반영 & M2 에러 처리

**사용자 가치**  
조기 종료/연장 후에도 간병인이 헷갈리지 않고 올바른 날짜만 작성하도록 한다.

**Scope**  
- `/caregiver/[token]/logs` 날짜 리스트
  - `start_date` ~ `end_date_final` 기준으로 생성
  - 조기 종료된 이후 날짜는 비활성/표시 안 함
- `/logs/[date]` 접근 시
  - 기간 밖 날짜는 에러 혹은 접근 제한
- 기본 에러 처리
  - 동의 전 `/logs` 접근 시 동의 화면으로 안내
  - 종료된 케이스에서 추가 작성 시도 시 안내 메시지

**완료 기준**  
- 보호자 기간 조정 후, 간병인 화면이 이에 맞게 갱신
- 잘못된 날짜(직접 URL 입력 등) 접근 시도에도 안전하게 처리
