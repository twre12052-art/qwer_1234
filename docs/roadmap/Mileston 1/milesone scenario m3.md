# M3 – 지급 정보 & PDF Scenario 모음

---

## M3-WP1 (지급 정보 입력)

Scenario M3-WP1-1: 지급 정보 최초 입력 성공  
Given: 케이스가 진행을 마쳤고 보호자가 `/cases/[id]` 상세 화면을 보고 있다  
When: [지급 정보 입력] 버튼을 눌러 총 일수, 총액, 지급일, 지급 방식을 입력하고 저장한다  
Then: `payments` 레코드가 생성되고 케이스 상세 상단에 지급 정보 요약이 표시된다  
선행 Scenario: M2-WP3-2  

---

Scenario M3-WP1-2: 지급 정보 수정 성공  
Given: 해당 케이스에 기존 지급 정보가 이미 등록되어 있다  
When: 보호자가 [지급 정보 입력]을 다시 열어 금액이나 지급일을 수정한 후 저장한다  
Then: 기존 `payments` 레코드가 업데이트되고 케이스 상세 화면 요약 정보가 수정된 내용으로 표시된다  
선행 Scenario: M3-WP1-1  

---

Scenario M3-WP1-3: 지급 정보 미입력 상태 표시  
Given: 케이스에는 아직 어떠한 지급 정보도 저장되지 않았다  
When: 보호자가 `/cases/[id]` 상세를 연다  
Then: 지급 정보 영역에 “미입력” 또는 “지급 정보가 없습니다”와 같은 문구가 표시된다  
선행 Scenario: M1-WP3-2  

---

## M3-WP2 (PDF 인프라 & 한글 폰트)

Scenario M3-WP2-1: 한글 폰트 적용된 테스트 PDF 생성 성공  
Given: 프로젝트에 한글 폰트 파일이 추가되어 있고 PDF 테스트 액션이 구현되어 있다  
When: 개발자가 테스트용 PDF 생성 엔드포인트를 호출한다  
Then: 한글 문장이 포함된 PDF 파일이 생성되어 로컬 및 Vercel 환경에서 열었을 때 글자가 깨지지 않는다  
선행 Scenario: 없음  

---

## M3-WP3 (PDF 템플릿 – 5종 서류)

Scenario M3-WP3-1: 샘플 데이터로 5종 서류 PDF 구조 확인  
Given: 케이스, 간병일지, 간병인 정보, 사업자 정보, 지급 정보가 모두 존재하는 샘플 케이스가 있다  
When: 개발자가 해당 케이스로 PDF 생성 테스트를 수행한다  
Then: 생성된 PDF 안에 ①간병 계약서 ②간병일지 요약 ③간병인 확인서 ④소속 확인서 ⑤지급 확인서 섹션이 모두 포함되어 있다  
선행 Scenario: M3-WP2-1  

---

Scenario M3-WP3-2: 하단 고정 문구 노출 확인  
Given: PDF 템플릿에 고정 문구가 추가된 상태이다  
When: 임의의 케이스로 PDF를 생성해 문서를 스크롤해 본다  
Then: 하단에 “이 서류는 보험 청구용이며, 연말정산 의료비 공제용 영수증이 아닙니다.”라는 문구가 포함되어 있다  
선행 Scenario: M3-WP3-1  

---

## M3-WP4 (PDF 생성 버튼 & 조건 체크)

Scenario M3-WP4-1: 조건 충족 시 PDF 생성 및 다운로드 성공  
Given: 보호자/간병인 동의, 필요한 기간의 간병일지, 지급 정보가 모두 입력된 케이스가 있다  
When: 보호자가 `/cases/[id]` 상세에서 [PDF 서류 만들기] 버튼을 클릭한다  
Then: 서버에서 데이터 검증 후 PDF가 생성되며 브라우저에서 다운로드(또는 열기) 동작이 시작된다  
선행 Scenario: M3-WP1-1, M3-WP3-1  

---

Scenario M3-WP4-2: 간병일지 누락으로 PDF 생성 실패  
Given: 케이스가 존재하고 동의 및 지급 정보는 있지만, 간병일지가 하나도 작성되지 않았다  
When: 보호자가 [PDF 서류 만들기] 버튼을 누른다  
Then: PDF가 생성되지 않고 “간병일지가 없습니다. 일지를 작성 후 다시 시도해 주세요”와 같은 부족 항목 안내가 표시된다  
선행 Scenario: M1-WP3-2, M3-WP1-1  

---

Scenario M3-WP4-3: 지급 정보 미입력으로 PDF 생성 실패  
Given: 케이스에 일지와 동의는 있지만 지급 정보가 입력되지 않았다  
When: 보호자가 [PDF 서류 만들기] 버튼을 클릭한다  
Then: “지급 정보를 먼저 입력해 주세요” 등의 메시지가 표시되고 PDF는 생성되지 않는다  
선행 Scenario: M2-WP3-2  
