Milestone 최종본

---

## M0. 기반 설계 & 환경 세팅

### 목표  
서비스 전체를 지탱할 기본 구조·규칙을 확정하고, 이후 Milestone에서 뒤집지 않을 기반을 만든다.

### 주요 작업  
- Next.js + Supabase 기본 프로젝트 세팅  
- 폴더 구조 및 도메인 모듈 구조 확정  
  - 예: `auth`, `case`, `careLog`, `pdf`, `shared` 등  
- DB 스키마 1차 버전 확정 및 생성  
  - `users`, `cases`, `care_logs`, `payments`, `case_tokens`  
  - 간병인 정보 컬럼을 포함한 `cases` 구조  
- 상태(status) 전이 규칙 정의  
  - 예: `GUARDIAN_PENDING → CAREGIVER_PENDING → IN_PROGRESS → …`  
- 입력값 유효성 규칙 정의  
  - 케이스 생성, 간병인 동의, 일지 입력 등 기본 검증 규칙  
- 주민번호 처리용 유틸 “틀” 정의  
  - 1차는 평문 사용, 2차에서 암호화/축소수집로 전환 예정  
- 사업자 정보 기본값 정의  
  - 상호, 사업자번호, 대표자, 주소, 직업소개업 등록번호 등  
  - 소속 확인서에 사용할 정보로 정리

### 산출물  
- 초기 코드베이스 및 폴더 구조  
- DB 테이블 및 컬럼 정의 문서  
- 상태 전이 규칙표  
- 사업자 정보 설정 값 정리

---

## M1. 보호자 플로우 1차 – 로그인, 케이스 생성, 계약 동의, 기간 변경

### 목표  
보호자가 로그인 후 간병 케이스를 등록하고, 계약서를 확인·동의한 뒤 간병인에게 링크를 보낼 수 있도록 한다.  
또한 보호자가 간병 기간(조기 종료/연장)을 관리할 수 있게 한다.

### 주요 작업  
- 보호자 인증 플로우  
  - 회원가입, 로그인·로그아웃  
  - 로그인 후 케이스 목록으로 이동  
- 케이스 관리 기본 기능  
  - 케이스 목록 조회  
  - 새 케이스 등록  
  - 케이스 상세 페이지 구성  
- 보호자 계약 동의 단계 추가  
  - 케이스 생성 후 “계약서 확인/동의” 화면 (`/cases/[id]/agreement`)  
  - 계약서 요약 + 전문 보기  
  - 동의 시 보호자 동의 시각 저장 (`guardian_agreed_at`)  
  - 동의 후에만 간병인 링크 활성화  
- 간병 기간 변경 기능  
  - 조기 종료: 종료 일자 조정, 이후 일지 비활성화 처리 정책 반영  
  - 연장: 종료 일자 연장, 이후 일지 작성 가능 기간 확장  
- 기본 에러 처리  
  - 이메일 중복, 로그인 실패, 필수 필드 누락 등의 기본 안내

### 산출물  
- 보호자용 로그인/케이스 화면 일체  
- 계약 동의가 포함된 케이스 생성 플로우  
- 조기 종료/연장이 가능한 케이스 상세 화면  
- 간병인 링크(동의 이후 활성화)

### 의존성  
- M0 선행 필요  
- 이후 M2(간병인 플로우)의 기반이 됨

---

## M2. 간병인 플로우 1차 – 토큰 동의 & 간병일지

### 목표  
간병인이 앱 설치 없이 링크만으로 간병 내용을 확인하고, 본인 정보를 입력·동의한 뒤 매일 간병일지를 작성할 수 있게 한다.

### 주요 작업  
- 간병인 토큰 진입 플로우  
  - 보호자가 보낸 링크로 진입  
  - 토큰을 통해 해당 케이스 조회  
  - 유효하지 않은/만료된 토큰에 대한 안내 페이지  
- 간병인 정보 입력 및 동의  
  - 간병 내용(환자, 기간, 병원, 일당 등) 확인  
  - 간병인 이름·연락처·주민번호·주소·계좌 입력  
  - 동의 시 간병인 정보 및 동의 시각 저장 (`caregiver_agreed_at`)  
  - 상태를 간병인 동의 완료 상태로 변경  
- 간병일지 작성  
  - 날짜별 일지 목록 화면  
  - 하루 단위 체크·메모 입력 화면  
  - 조기 종료·연장된 기간에 맞춰 작성 가능 날짜 제한  
- 기본 에러 처리  
  - 잘못된/만료 토큰  
  - 이미 동의한 케이스 재접속 시 처리(일지 화면으로 안내 등)

### 산출물  
- 간병인용 링크 진입 화면  
- 간병인 정보 입력 및 동의 플로우  
- 날짜별 간단 간병일지 작성 기능  
- 토큰 기반 접근 제어 기본 동작

### 의존성  
- M1에서 생성된 케이스·토큰·상태를 전제로 함  
- 이후 PDF 생성(M3)에 필요한 데이터(일지, 간병인 정보)를 쌓는 역할

---

## M3. 지급 정보 & PDF 서류 5종

### 목표  
보호자가 실제 지급 정보를 입력하고, 보험 청구에 필요한 5종 서류를 한 번에 PDF로 생성할 수 있게 한다.

### 주요 작업  
- 지급 정보 입력 기능  
  - 총 일수, 총액, 지급일, 지급 방식 입력·수정  
- 한글 폰트 적용 검증  
  - 한글 폰트 파일 프로젝트 포함  
  - 로컬 및 배포 환경에서 한글이 깨지지 않는지 테스트  
- PDF 템플릿 구성  
  - 하나의 PDF 안에 다음 5종 서류 포함  
    1. 간병 계약서  
    2. 간병일지(날짜별 요약)  
    3. 간병인 확인서  
    4. 소속 확인서(사업자 정보 포함)  
    5. 간병비 지급 확인서  
  - 하단 고정 문구 추가  
    - 예: “이 서류는 보험 청구용이며, 연말정산 의료비 공제용 영수증이 아닙니다.”  
- PDF 생성 플로우  
  - 케이스·간병일지·지급 정보 조회  
  - 생성 조건 체크(동의·일지·지급정보 유무)  
  - 조건 미충족 시 부족 항목 안내  
  - 조건 충족 시 PDF 다운로드 제공

### 산출물  
- 지급 정보 입력 화면  
- 5종 서류가 포함된 통합 PDF 생성 기능  
- 기본적인 조건 검증 로직 및 안내 문구

### 의존성  
- M1에서 케이스 및 보호자 동의 완료  
- M2에서 간병인 동의 및 간병일지 데이터 축적  
- M0에서 정의한 사업자 정보·상태 규칙 활용

---

## M4. QA, 배포, 최소 법적 요건 정리

### 목표  
1차 MVP를 실제 사용 가능한 수준으로 마무리하고, 프로덕션 환경에 배포하며, 2차 개선 과제를 정리한다.

### 주요 작업  
- 통합 QA  
  - 보호자·간병인 대표 시나리오 테스트  
  - 조기 종료/연장, 일부 일지 누락 등 엣지 케이스 점검  
- 데이터 정합성 점검  
  - 케이스–일지–지급정보–토큰 관계 검토  
  - 상태(status) 흐름이 정의대로 동작하는지 확인  
- 배포 환경 세팅  
  - Vercel 프로덕션 배포  
  - Supabase 프로덕션 DB 연결  
  - 환경변수 정리(dev/prod 분리)  
- 최소 법적 요건  
  - 개인정보 처리방침 안내 페이지 작성  
  - 주민번호·계좌번호 수집 및 활용 목적 명시  
- 2차 Milestone 후보 정리  
  - 전자 서명(보호자·간병인)  
  - 주민번호 암호화/축소 수집  
  - 알림(카카오 알림톡 등)  
  - RLS·보안·세션 최적화 등 운영 강화를 위한 작업 목록화

### 산출물  
- 프로덕션 환경에 배포된 1차 MVP  
- QA 결과 및 개선 이슈 목록  
- 개인정보 처리방침 페이지  
- 2차 Milestone·백로그 정리

### 의존성  
- M0~M3 완료 후 수행  
- 이후 모든 추가 개발의 기준 버전 역할

---

## Milestone 순서 및 의존성 요약

1. **M0 – 기반 설계 & 환경 세팅**  
   - 전체 프로젝트의 공통 규칙·구조 확립

2. **M1 – 보호자 플로우 1차**  
   - 케이스 생성·계약 동의·기간 관리까지 완성

3. **M2 – 간병인 플로우 1차**  
   - 토큰 기반 접근, 간병인 동의, 간병일지 작성

4. **M3 – 지급 정보 & PDF 5종**  
   - 데이터들을 묶어 보험 청구용 PDF로 완성

5. **M4 – QA, 배포, 최소 법적 요건**  
   - 프로덕션 배포 및 2차 확장 준비
