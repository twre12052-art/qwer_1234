# 📧 이메일 발송 문제 해결 가이드

## 🔍 문제 확인 체크리스트

### 1. Gmail 앱 비밀번호 확인 (가장 중요!)

**⚠️ 일반 비밀번호가 아닌 "앱 비밀번호" 필요!**

#### Gmail 앱 비밀번호 만들기:

1. **Google 계정 → 보안** 접속
   ```
   https://myaccount.google.com/security
   ```

2. **2단계 인증 켜기** (필수!)
   - "2단계 인증" 섹션 찾기
   - 켜져 있지 않으면 활성화

3. **앱 비밀번호 생성**
   - 검색창에 "앱 비밀번호" 입력
   - [앱 비밀번호] 클릭
   - 앱: "메일" 선택
   - 기기: "Windows 컴퓨터" 선택
   - [생성] 클릭

4. **16자리 비밀번호 복사**
   ```
   예: abcd efgh ijkl mnop
   → abcdefghijklmnop (공백 제거)
   ```

---

### 2. .env.local 파일 확인

#### 파일 위치:
```
C:\Users\MY\Desktop\cursor 1\.env.local
```

#### 정확한 형식:
```bash
# Supabase 설정 (이미 있음)
NEXT_PUBLIC_SUPABASE_URL=...
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
SUPABASE_SERVICE_KEY=...

# Gmail 설정 (추가!)
GMAIL_USER=your.email@gmail.com
GMAIL_APP_PASSWORD=16자리앱비밀번호
```

#### ⚠️ 주의사항:
- `=` 앞뒤에 **공백 없음**
- **따옴표 없음** (그냥 값만!)
- 줄바꿈으로 구분
- 비밀번호는 **공백 제거**

#### ❌ 잘못된 예:
```bash
GMAIL_USER = "your@gmail.com"  # = 앞뒤 공백, 따옴표
GMAIL_APP_PASSWORD="abcd efgh ijkl mnop"  # 공백 포함
```

#### ✅ 올바른 예:
```bash
GMAIL_USER=your.email@gmail.com
GMAIL_APP_PASSWORD=abcdefghijklmnop
```

---

### 3. 서버 재시작 (필수!)

**.env.local 수정 후 반드시 재시작!**

#### 방법:
```
1. 터미널에서 Ctrl + C
2. npm run dev
```

---

### 4. 터미널 에러 확인

#### 이메일 발송 시도 시 터미널에서 확인:

**✅ 정상**:
```
(에러 없음)
```

**❌ 환경 변수 없음**:
```
⚠️ Gmail 환경 변수가 설정되지 않았습니다.
GMAIL_USER와 GMAIL_APP_PASSWORD를 .env.local에 추가하세요.
```

**❌ 인증 실패**:
```
이메일 발송 에러: Invalid login
이메일 발송 에러: Username and Password not accepted
```
→ 앱 비밀번호가 틀렸거나 2단계 인증이 안 됨

**❌ 연결 실패**:
```
이메일 발송 에러: connect ETIMEDOUT
```
→ 네트워크 문제 또는 방화벽

---

## 🧪 단계별 해결 방법

### Step 1: .env.local 확인 및 수정

1. Cursor에서 `.env.local` 파일 열기
2. Gmail 설정 추가:
   ```bash
   GMAIL_USER=your.email@gmail.com
   GMAIL_APP_PASSWORD=abcdefghijklmnop
   ```
3. 저장 (Ctrl + S)

---

### Step 2: 앱 비밀번호 생성

1. https://myaccount.google.com/security
2. "2단계 인증" 활성화
3. "앱 비밀번호" 생성
4. 16자리 복사 (공백 제거)
5. `.env.local`에 붙여넣기

---

### Step 3: 서버 재시작

1. 터미널에서 **Ctrl + C**
2. `npm run dev` 실행
3. 서버 시작 대기

---

### Step 4: 테스트

1. 브라우저에서 **Ctrl + Shift + R**
2. 케이스 상세 페이지
3. "서류 생성 및 발송" 섹션
4. 이메일 주소 입력 (올바른 형식)
5. [이메일로 받기] 클릭

---

### Step 5: 터미널 확인

**성공 시**:
- 에러 없음
- "이메일이 발송되었습니다" 알림

**실패 시**:
- 터미널에 에러 메시지 확인
- 에러 메시지 복사해서 알려주세요!

---

## 🚨 자주 발생하는 문제

### 문제 1: "Gmail 설정이 필요합니다"
**원인**: 환경 변수 누락 또는 서버 재시작 안 함

**해결**:
```
1. .env.local 확인
2. Ctrl + C → npm run dev
3. 다시 시도
```

---

### 문제 2: "Invalid login"
**원인**: 앱 비밀번호 아닌 일반 비밀번호 사용

**해결**:
```
1. Google 계정 → 보안
2. 2단계 인증 활성화
3. 앱 비밀번호 새로 생성
4. .env.local 업데이트
5. 서버 재시작
```

---

### 문제 3: "올바른 이메일 주소를 입력해주세요"
**원인**: 이메일 형식 오류

**해결**:
```
❌ test@gmail  # 도메인 없음
❌ test gmail.com  # @ 없음
✅ test@gmail.com  # 정상
```

---

## 💡 빠른 확인 방법

### 터미널에서 환경 변수 확인:

**PowerShell**:
```powershell
$env:GMAIL_USER
$env:GMAIL_APP_PASSWORD
```

**결과가 나오면** ✅ 설정됨  
**빈 결과** ❌ 설정 안 됨 → 서버 재시작 필요

---

## 📋 최종 체크리스트

이메일 발송 전 확인:

- [ ] 2단계 인증 활성화
- [ ] Gmail 앱 비밀번호 생성 (16자리)
- [ ] .env.local에 정확히 추가 (공백/따옴표 없음)
- [ ] 서버 재시작 (Ctrl+C → npm run dev)
- [ ] 브라우저 새로고침 (Ctrl+Shift+R)
- [ ] 올바른 이메일 형식 입력
- [ ] 터미널 에러 확인

---

## 🎯 여전히 안 되면?

**터미널에 표시되는 정확한 에러 메시지를 알려주세요!**

예:
```
이메일 발송 에러: [여기 에러 내용]
```

에러 메시지를 보면 정확한 원인을 찾을 수 있습니다!

---

**작성일**: 2025-12-07

